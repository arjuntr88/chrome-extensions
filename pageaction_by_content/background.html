<!DOCTYPE html>
<!--
 * Copyright (c) 2010 The Chromium Authors. All rights reserved.  Use of this
 * source code is governed by a BSD-style license that can be found in the
 * LICENSE file.
-->
<html>
  <head>
    <script>
	var regex1=/Finished: SUCCESS/;
	var cons=/console/;
	var buildFin
      // Called when a message is passed.  We assume that the content script
      // wants to show the page action.
      function onRequest(request, sender, sendResponse) {
        // Show the page action for the tab that the sender (content script)
        // was on.
        buildFin=request;
		//alert(request);
		chrome.pageAction.show(sender.tab.id);
		chrome.pageAction.setIcon({path:"B&R.png",tabId:sender.tab.id});
        // Return nothing to let the connection be cleaned up.
	/* 	if (window.webkitNotifications) {
		console.log("Notifications are supported!");
		}
		else {
		console.log("Notifications are not supported for this Browser/OS version yet.");
		} */
		
		if(cons.test(sender.tab.url)){
		//alert(request);
		if(request!=true)
		{
		//alert("'");
		console.log("req!=true");
		testBuild();
		//sleep(5000);
		}
		if(request==true)
		{
		console.log("req==true");
		var notification = webkitNotifications.createNotification('B&R.png', 'success','Build Successfull');
		notification.show();
		}
		
		//var notification = webkitNotifications.createNotification('B&R.png', 'success','Build Successfull');
		//notification.show();
		
		
		/* if(regex1.test(document.body.innerText)){
		var notification = webkitNotifications.createNotification('B&R.png', 'success','Build Successfull');
		notification.show();
		} */
		}
		/* 
		if(regex1.test(document.body.innerText))
		{
		var notification=webkitNotifications.createNotification('B&R.png', 'success','Build Successfull'+sender.tab.url);
		notification.show();
		} */
        sendResponse({});
      };
	  function sleep(milliseconds) {
  var start = new Date().getTime();
  for (var i = 0; i < 1e15; i++) {
    if ((new Date().getTime() - start) > milliseconds){
      break;
    }
  }
}
	
function onStateChange(newState)
{
alert("change");
}
	function testBuild()
		{
		
		chrome.tabs.executeScript(null, {file: 'content_script.js'});
		}
      // Listen for the content script to send a message to the background page.
      chrome.extension.onRequest.addListener(onRequest);
	  chrome.idle.onStateChanged.addListener(onStateChange);
    </script>
  </head>
</html>
